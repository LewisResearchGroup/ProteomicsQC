{% extends "base.html" %}

{% block content %}
  <div class='block run-header-card pipeline-page-header-card'>
    <div class="pipeline-header-row">
      <div class="pipeline-header-text">
        <div class="run-meta-grid pipeline-meta-grid">
          <div class="run-meta-tile">
            <div class="run-meta-tile-label">Project</div>
            <div class="run-meta-tile-value">{{ object.name }}</div>
          </div>
          <div class="run-meta-tile">
            <div class="run-meta-tile-label">Slug</div>
            <div class="run-meta-tile-value">{{ object.slug }}</div>
          </div>
          <div class="run-meta-tile">
            <div class="run-meta-tile-label">Description</div>
            <div class="run-meta-tile-value">{{ object.description }}</div>
          </div>
          <div class="run-meta-tile run-meta-tile-ghost" aria-hidden="true">
            <div class="run-meta-tile-label">Slug</div>
            <div class="run-meta-tile-value">-</div>
          </div>
        </div>
      </div>
      <div class="pipeline-actions run-actions-column">
        <a href="{% url 'project:list' %}" class="project-back-link">
          <button class='btn run-btn run-btn-primary' title='Back to projects overview.'>
            <span class="run-btn-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" width="16" height="16" focusable="false">
                <path
                  d="M15.5 5.5a1 1 0 0 1 0 1.4L10.4 12l5.1 5.1a1 1 0 0 1-1.4 1.4l-5.8-5.8a1 1 0 0 1 0-1.4l5.8-5.8a1 1 0 0 1 1.4 0Z"
                  fill="currentColor"
                />
              </svg>
            </span>
            <span class="project-back-text">Return to projects</span>
          </button>
        </a>
        <a href="{% url 'project:download_pipelines' object.slug %}">
          <button
            class='btn run-btn run-btn-secondary'
            title='Download pipelines summary for this project.'
          >
            Download summary CSV
          </button>
        </a>
      </div>
    </div>
  </div>

  <div class='block pipeline-block'>
    <h3>Pipelines</h3>
    <form method="get" class="project-list-controls" aria-label="Pipeline search and filters">
      <input
        type="search"
        name="q"
        class="project-filter-input"
        value="{{ pipeline_search_query }}"
        placeholder="Search by pipeline name, description, or slug"
      >
      <select name="raw" class="project-filter-select" aria-label="Raw files filter">
        <option value="all" {% if pipeline_raw_filter == "all" %}selected{% endif %}>All pipelines</option>
        <option value="with" {% if pipeline_raw_filter == "with" %}selected{% endif %}>With raw files</option>
        <option value="without" {% if pipeline_raw_filter == "without" %}selected{% endif %}>No raw files</option>
      </select>
      <select name="flagged" class="project-filter-select" aria-label="Flagged files filter">
        <option value="all" {% if pipeline_flagged_filter == "all" %}selected{% endif %}>All flagged states</option>
        <option value="flagged" {% if pipeline_flagged_filter == "flagged" %}selected{% endif %}>Has flagged files</option>
        <option value="clean" {% if pipeline_flagged_filter == "clean" %}selected{% endif %}>No flagged files</option>
      </select>
      <select name="downstream" class="project-filter-select" aria-label="Downstream filter">
        <option value="all" {% if pipeline_downstream_filter == "all" %}selected{% endif %}>All downstream states</option>
        <option value="with" {% if pipeline_downstream_filter == "with" %}selected{% endif %}>Has downstream files</option>
        <option value="without" {% if pipeline_downstream_filter == "without" %}selected{% endif %}>No downstream files</option>
      </select>
      <button type="submit" class="project-filter-btn">Apply</button>
      <a href="{% url 'project:detail' slug=object.slug %}" class="project-filter-reset">Reset</a>
    </form>
    {% include 'proteomics/include/list_pipelines.html' with project=object.slug %}
  </div>

  {% if maxquant_pipelines.has_other_pages %}
  <ul class="pagination">
    {% if maxquant_pipelines.has_previous %}
    <li><a href="?{% if pipeline_querystring %}{{ pipeline_querystring }}&{% endif %}page={{ maxquant_pipelines.previous_page_number }}">&laquo;</a></li>
    {% else %}
    <li class="disabled"><span>&laquo;</span></li>
    {% endif %}
    {% for i in maxquant_pipelines.paginator.page_range %}
    {% if maxquant_pipelines.number == i %}
        <li class="active"><span>{{ i }} <span class="sr-only">(current)</span></span></li>
    {% else %}
        <li><a href="?{% if pipeline_querystring %}{{ pipeline_querystring }}&{% endif %}page={{ i }}">{{ i }}</a></li>
    {% endif %}
    {% endfor %}
    {% if maxquant_pipelines.has_next %}
    <li><a href="?{% if pipeline_querystring %}{{ pipeline_querystring }}&{% endif %}page={{ maxquant_pipelines.next_page_number }}">&raquo;</a></li>
    {% else %}
    <li class="disabled"><span>&raquo;</span></li>
    {% endif %}
  </ul>

{% endif %}  

{% endblock %}
